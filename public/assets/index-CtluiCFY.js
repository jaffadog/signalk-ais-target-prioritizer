(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const ue=new Map([["401",{code:"AF",name:"Afghanistan"}],["201",{code:"AL",name:"Albania"}],["605",{code:"DZ",name:"Algeria"}],["202",{code:"AD",name:"Andorra"}],["603",{code:"AO",name:"Angola"}],["304",{code:"AG",name:"Antigua and Barbuda"}],["305",{code:"AG",name:"Antigua and Barbuda"}],["701",{code:"AR",name:"Argentina"}],["216",{code:"AM",name:"Armenia"}],["503",{code:"AU",name:"Australia"}],["516",{code:"AU",name:"Australia - Christmas Island"}],["523",{code:"AU",name:"Australia - Cocos Islands"}],["203",{code:"AT",name:"Austria"}],["423",{code:"AZ",name:"Azerbaijan"}],["308",{code:"BS",name:"Bahamas"}],["309",{code:"BS",name:"Bahamas"}],["311",{code:"BS",name:"Bahamas"}],["408",{code:"BH",name:"Bahrain"}],["405",{code:"BD",name:"Bangladesh"}],["314",{code:"BB",name:"Barbados"}],["206",{code:"BY",name:"Belarus"}],["205",{code:"BE",name:"Belgium"}],["312",{code:"BZ",name:"Belize"}],["610",{code:"BJ",name:"Benin"}],["410",{code:"BT",name:"Bhutan"}],["720",{code:"BO",name:"Bolivia"}],["478",{code:"BA",name:"Bosnia and Herzegovina"}],["611",{code:"BW",name:"Botswana"}],["710",{code:"BR",name:"Brazil"}],["508",{code:"BN",name:"Brunei Darussalam"}],["207",{code:"BG",name:"Bulgaria"}],["633",{code:"BF",name:"Burkina Faso"}],["609",{code:"BI",name:"Burundi"}],["617",{code:"CV",name:"Cabo Verde"}],["514",{code:"KH",name:"Cambodia"}],["515",{code:"KH",name:"Cambodia"}],["613",{code:"CM",name:"Cameroon"}],["316",{code:"CA",name:"Canada"}],["612",{code:"CF",name:"Central African Republic"}],["670",{code:"TD",name:"Chad"}],["725",{code:"CL",name:"Chile"}],["412",{code:"CN",name:"China"}],["413",{code:"CN",name:"China"}],["414",{code:"CN",name:"China"}],["416",{code:"CN",name:"China"}],["453",{code:"CN",name:"China"}],["477",{code:"CN",name:"China"}],["730",{code:"CO",name:"Colombia"}],["616",{code:"KM",name:"Comoros"}],["620",{code:"KM",name:"Comoros"}],["615",{code:"CD",name:"Congo"}],["321",{code:"CR",name:"Costa Rica"}],["619",{code:"CI",name:"Côte d'Ivoire"}],["238",{code:"HR",name:"Croatia"}],["323",{code:"CU",name:"Cuba"}],["209",{code:"CY",name:"Cyprus"}],["210",{code:"CY",name:"Cyprus"}],["212",{code:"CY",name:"Cyprus"}],["270",{code:"CZ",name:"Czech Republic"}],["445",{code:"KR",name:"Democratic People's Republic of Korea"}],["676",{code:"CD",name:"Democratic Republic of the Congo"}],["219",{code:"DK",name:"Denmark"}],["220",{code:"DK",name:"Denmark"}],["231",{code:"DK",name:"Denmark - Faroe Islands"}],["331",{code:"DK",name:"Denmark - Greenland"}],["621",{code:"DJ",name:"Djibouti"}],["325",{code:"DM",name:"Dominica"}],["327",{code:"DO",name:"Dominican Republic"}],["735",{code:"EC",name:"Ecuador"}],["622",{code:"EG",name:"Egypt"}],["359",{code:"SV",name:"El Salvador"}],["631",{code:"GQ",name:"Equatorial Guinea"}],["625",{code:"ER",name:"Eritrea"}],["276",{code:"EE",name:"Estonia"}],["669",{code:"SZ",name:"Eswatini"}],["624",{code:"ET",name:"Ethiopia"}],["520",{code:"FJ",name:"Fiji"}],["230",{code:"FI",name:"Finland"}],["226",{code:"FR",name:"France"}],["227",{code:"FR",name:"France"}],["228",{code:"FR",name:"France"}],["501",{code:"FR",name:"France - Adelie Land"}],["618",{code:"FR",name:"France - Crozet Archipelago"}],["546",{code:"FR",name:"France - French Polynesia"}],["329",{code:"FR",name:"France - Guadeloupe"}],["745",{code:"FR",name:"France - Guiana"}],["635",{code:"FR",name:"France - Kerguelen Islands"}],["347",{code:"FR",name:"France - Martinique"}],["540",{code:"FR",name:"France - New Caledonia"}],["660",{code:"FR",name:"France - Reunion"}],["607",{code:"FR",name:"France - Saint Paul and Amsterdam Islands"}],["361",{code:"FR",name:"France - Saint Pierre and Miquelon"}],["578",{code:"FR",name:"France - Wallis and Futuna Islands"}],["626",{code:"GA",name:"Gabonese Republic"}],["629",{code:"GM",name:"Gambia"}],["213",{code:"GE",name:"Georgia"}],["211",{code:"DE",name:"Germany"}],["218",{code:"DE",name:"Germany"}],["627",{code:"GH",name:"Ghana"}],["237",{code:"GR",name:"Greece"}],["239",{code:"GR",name:"Greece"}],["240",{code:"GR",name:"Greece"}],["241",{code:"GR",name:"Greece"}],["330",{code:"GD",name:"Grenada"}],["332",{code:"GT",name:"Guatemala"}],["632",{code:"GN",name:"Guinea"}],["630",{code:"GW",name:"Guinea-Bissau"}],["750",{code:"GY",name:"Guyana"}],["336",{code:"HT",name:"Haiti"}],["334",{code:"HN",name:"Honduras"}],["243",{code:"HU",name:"Hungary"}],["251",{code:"IS",name:"Iceland"}],["419",{code:"IN",name:"India"}],["525",{code:"ID",name:"Indonesia"}],["422",{code:"IR",name:"Iran"}],["425",{code:"IQ",name:"Iraq"}],["250",{code:"IE",name:"Ireland"}],["428",{code:"IL",name:"Israel"}],["247",{code:"IT",name:"Italy"}],["339",{code:"JM",name:"Jamaica"}],["431",{code:"JP",name:"Japan"}],["432",{code:"JP",name:"Japan"}],["438",{code:"JO",name:"Jordan"}],["436",{code:"KZ",name:"Kazakhstan"}],["634",{code:"KE",name:"Kenya"}],["529",{code:"KI",name:"Kiribati"}],["440",{code:"KR",name:"Korea"}],["441",{code:"KR",name:"Korea"}],["447",{code:"KW",name:"Kuwait"}],["451",{code:"KG",name:"Kyrgyz Republic"}],["531",{code:"LA",name:"Lao People's Democratic Republic"}],["275",{code:"LV",name:"Latvia"}],["450",{code:"LB",name:"Lebanon"}],["644",{code:"LS",name:"Lesotho"}],["636",{code:"LR",name:"Liberia"}],["637",{code:"LR",name:"Liberia"}],["642",{code:"LY",name:"Libya"}],["252",{code:"LI",name:"Liechtenstein"}],["277",{code:"LT",name:"Lithuania"}],["253",{code:"LU",name:"Luxembourg"}],["647",{code:"MG",name:"Madagascar"}],["655",{code:"MW",name:"Malawi"}],["533",{code:"MY",name:"Malaysia"}],["455",{code:"MV",name:"Maldives"}],["649",{code:"ML",name:"Mali"}],["215",{code:"MT",name:"Malta"}],["229",{code:"MT",name:"Malta"}],["248",{code:"MT",name:"Malta"}],["249",{code:"MT",name:"Malta"}],["256",{code:"MT",name:"Malta"}],["538",{code:"MH",name:"Marshall Islands"}],["654",{code:"MR",name:"Mauritania"}],["645",{code:"MU",name:"Mauritius"}],["345",{code:"MX",name:"Mexico"}],["510",{code:"FM",name:"Micronesia"}],["214",{code:"MD",name:"Moldova"}],["254",{code:"MC",name:"Monaco"}],["457",{code:"MN",name:"Mongolia"}],["262",{code:"ME",name:"Montenegro"}],["242",{code:"MA",name:"Morocco"}],["650",{code:"MZ",name:"Mozambique"}],["506",{code:"MM",name:"Myanmar"}],["659",{code:"NA",name:"Namibia"}],["544",{code:"NR",name:"Nauru"}],["459",{code:"NP",name:"Nepal"}],["244",{code:"NL",name:"Netherlands"}],["245",{code:"NL",name:"Netherlands"}],["246",{code:"NL",name:"Netherlands"}],["306",{code:"NL",name:"Netherlands"}],["307",{code:"NL",name:"Netherlands - Aruba"}],["306",{code:"NL",name:"Netherlands - Bonaire, Sint Eustatius and Saba"}],["306",{code:"NL",name:"Netherlands - Curaçao"}],["512",{code:"NZ",name:"New Zealand"}],["518",{code:"NZ",name:"New Zealand - Cook Islands"}],["542",{code:"NZ",name:"New Zealand - Niue"}],["350",{code:"NI",name:"Nicaragua"}],["656",{code:"NE",name:"Niger"}],["657",{code:"NG",name:"Nigeria"}],["274",{code:"MK",name:"North Macedonia"}],["257",{code:"NO",name:"Norway"}],["258",{code:"NO",name:"Norway"}],["259",{code:"NO",name:"Norway"}],["461",{code:"OM",name:"Oman"}],["463",{code:"PK",name:"Pakistan"}],["511",{code:"PW",name:"Palau"}],["351",{code:"PA",name:"Panama"}],["352",{code:"PA",name:"Panama"}],["353",{code:"PA",name:"Panama"}],["354",{code:"PA",name:"Panama"}],["355",{code:"PA",name:"Panama"}],["356",{code:"PA",name:"Panama"}],["357",{code:"PA",name:"Panama"}],["370",{code:"PA",name:"Panama"}],["371",{code:"PA",name:"Panama"}],["372",{code:"PA",name:"Panama"}],["373",{code:"PA",name:"Panama"}],["374",{code:"PA",name:"Panama"}],["553",{code:"PG",name:"Papua New Guinea"}],["755",{code:"PY",name:"Paraguay"}],["760",{code:"PE",name:"Peru"}],["548",{code:"PH",name:"Philippines"}],["261",{code:"PL",name:"Poland"}],["263",{code:"PT",name:"Portugal"}],["204",{code:"PT",name:"Portugal - Azores"}],["255",{code:"PT",name:"Portugal - Madeira"}],["466",{code:"QA",name:"Qatar"}],["271",{code:"TR",name:"Republic of Türkiye"}],["264",{code:"RO",name:"Romania"}],["273",{code:"RU",name:"Russian Federation"}],["661",{code:"RW",name:"Rwanda"}],["341",{code:"KN",name:"Saint Kitts and Nevis"}],["343",{code:"LC",name:"Saint Lucia"}],["375",{code:"VC",name:"Saint Vincent and the Grenadines"}],["376",{code:"VC",name:"Saint Vincent and the Grenadines"}],["377",{code:"VC",name:"Saint Vincent and the Grenadines"}],["561",{code:"WS",name:"Samoa"}],["268",{code:"SM",name:"San Marino"}],["668",{code:"ST",name:"Sao Tome and Principe"}],["403",{code:"SA",name:"Saudi Arabia"}],["663",{code:"SN",name:"Senegal"}],["279",{code:"RS",name:"Serbia"}],["664",{code:"SC",name:"Seychelles"}],["667",{code:"SL",name:"Sierra Leone"}],["563",{code:"SG",name:"Singapore"}],["564",{code:"SG",name:"Singapore"}],["565",{code:"SG",name:"Singapore"}],["566",{code:"SG",name:"Singapore"}],["267",{code:"SK",name:"Slovak Republic"}],["278",{code:"SI",name:"Slovenia"}],["557",{code:"SB",name:"Solomon Islands"}],["666",{code:"SO",name:"Somalia"}],["601",{code:"ZA",name:"South Africa"}],["638",{code:"SS",name:"South Sudan"}],["224",{code:"ES",name:"Spain"}],["225",{code:"ES",name:"Spain"}],["417",{code:"LK",name:"Sri Lanka"}],["443",{code:"PS",name:"State of Palestine"}],["662",{code:"SD",name:"Sudan"}],["765",{code:"SR",name:"Suriname"}],["265",{code:"SE",name:"Sweden"}],["266",{code:"SE",name:"Sweden"}],["269",{code:"CH",name:"Switzerland"}],["468",{code:"SY",name:"Syrian Arab Republic"}],["472",{code:"TJ",name:"Tajikistan"}],["674",{code:"TZ",name:"Tanzania"}],["677",{code:"TZ",name:"Tanzania"}],["567",{code:"TH",name:"Thailand"}],["550",{code:"TL",name:"Timor-Leste"}],["671",{code:"TG",name:"Togolese Republic"}],["570",{code:"TO",name:"Tonga"}],["362",{code:"TT",name:"Trinidad and Tobago"}],["672",{code:"TN",name:"Tunisia"}],["434",{code:"TM",name:"Turkmenistan"}],["572",{code:"TV",name:"Tuvalu"}],["675",{code:"UG",name:"Uganda"}],["272",{code:"UA",name:"Ukraine"}],["470",{code:"AE",name:"United Arab Emirates"}],["471",{code:"AE",name:"United Arab Emirates"}],["232",{code:"GB",name:"United Kingdom of Great Britain and Northern Ireland"}],["233",{code:"GB",name:"United Kingdom of Great Britain and Northern Ireland"}],["234",{code:"GB",name:"United Kingdom of Great Britain and Northern Ireland"}],["235",{code:"GB",name:"United Kingdom of Great Britain and Northern Ireland"}],["301",{code:"GB",name:"United Kingdom of Great Britain and Northern Ireland - Anguilla"}],["608",{code:"GB",name:"United Kingdom of Great Britain and Northern Ireland - Ascension Island"}],["310",{code:"GB",name:"United Kingdom of Great Britain and Northern Ireland - Bermuda"}],["378",{code:"GB",name:"United Kingdom of Great Britain and Northern Ireland - British Virgin Islands"}],["319",{code:"GB",name:"United Kingdom of Great Britain and Northern Ireland - Cayman Islands"}],["740",{code:"GB",name:"United Kingdom of Great Britain and Northern Ireland - Falkland Islands"}],["236",{code:"GB",name:"United Kingdom of Great Britain and Northern Ireland - Gibraltar"}],["348",{code:"GB",name:"United Kingdom of Great Britain and Northern Ireland - Montserrat"}],["555",{code:"GB",name:"United Kingdom of Great Britain and Northern Ireland - Pitcairn Island"}],["665",{code:"GB",name:"United Kingdom of Great Britain and Northern Ireland - Saint Helena"}],["364",{code:"GB",name:"United Kingdom of Great Britain and Northern Ireland - Turks and Caicos Islands"}],["338",{code:"US",name:"United States of America"}],["366",{code:"US",name:"United States of America"}],["367",{code:"US",name:"United States of America"}],["368",{code:"US",name:"United States of America"}],["369",{code:"US",name:"United States of America"}],["303",{code:"US",name:"United States of America - Alaska"}],["559",{code:"US",name:"United States of America - American Samoa"}],["536",{code:"US",name:"United States of America - Northern Mariana Islands"}],["358",{code:"US",name:"United States of America - Puerto Rico"}],["379",{code:"US",name:"United States of America - United States Virgin Islands"}],["770",{code:"UY",name:"Uruguay"}],["437",{code:"UZ",name:"Uzbekistan"}],["576",{code:"VU",name:"Vanuatu"}],["577",{code:"VU",name:"Vanuatu"}],["208",{code:"VA",name:"Vatican City State"}],["775",{code:"VE",name:"Venezuela"}],["574",{code:"VN",name:"Viet Nam"}],["473",{code:"YE",name:"Yemen"}],["475",{code:"YE",name:"Yemen"}],["678",{code:"ZM",name:"Zambia"}],["679",{code:"ZW",name:"Zimbabwe"}]]),E=1852,F=1.94384,Ue=600;function Ve(e,a,t,n){if(!a)throw console.warn("No GPS position available (no data for our own vessel)",a),new Error("No GPS position available (no data for our own vessel)");if(fe(a,a,t,n),!a.isValid)throw console.warn("No GPS position available (data is invalid)",a),new Error("No GPS position available (data is invalid)");e.forEach((o,r)=>{r!=a.mmsi&&fe(o,a,t,n)})}function g(e){return e*Math.PI/180}function M(e){return e*180/Math.PI}function fe(e,a,t,n){e.y=e.latitude*111120,e.x=e.longitude*111120*Math.cos(g(a.latitude)),e.vy=e.sog*Math.cos(e.cog),e.vx=e.sog*Math.sin(e.cog),e.mmsi!=a.mmsi&&(De(a,e),Ke(a,e),He(e,t));var o=Math.round((new Date-e.lastSeenDate)/1e3);o<0&&(o=0);var r=je(e.mmsi);e.lastSeen=o,e.isLost=o>Ue,e.mmsiCountryCode=ue.get(r)?.code,e.mmsiCountryName=ue.get(r)?.name,e.cpaFormatted=Ye(e.cpa),e.tcpaFormatted=Qe(e.tcpa),e.rangeFormatted=e.range!=null?(e.range/E).toFixed(2)+" NM":"---",e.bearingFormatted=e.bearing!=null?e.bearing+" T":"---",e.sogFormatted=e.sog!=null?(e.sog*F).toFixed(1)+" kn":"---",e.cogFormatted=e.cog!=null?Math.round(M(e.cog))+" T":"---",e.hdgFormatted=e.hdg!=null?Math.round(M(e.hdg))+" T":"---",e.rotFormatted=Math.round(M(e.rot))||"---",e.aisClassFormatted=e.aisClass+(e.isVirtual?" (virtual)":""),e.sizeFormatted=`${e.length?.toFixed(1)??"---"} m x ${e.beam?.toFixed(1)??"---"} m`,e.imoFormatted=e.imo?.replace(/imo/i,"")||"---",e.latitudeFormatted=Je(e.latitude),e.longitudeFormatted=qe(e.longitude),!e.latitude||!e.longitude||e.lastSeen>n?e.isValid=!1:e.isValid=!0}function De(e,a){if(!e.isValid||!a.latitude||!a.longitude){a.range=null,a.bearing=null;return}a.range=Math.round(Ze(e.latitude,e.longitude,a.latitude,a.longitude)),a.bearing=Math.round(_e(e.latitude,e.longitude,a.latitude,a.longitude)),a.bearing>=360&&(a.bearing=0)}function Ke(e,a){if(e.x==null||e.y==null||e.vx==null||e.vy==null||a.x==null||a.y==null||a.vx==null||a.vy==null){a.cpa=null,a.tcpa=null;return}var t={x:a.vx-e.vx,y:a.vy-e.vy},n=j(t,t);if(n<1e-8){a.cpa=null,a.tcpa=null;return}var o={x:a.x-e.x,y:a.y-e.y},r=-j(o,t)/n;if(!r||r<0||r>3*3600){a.cpa=null,a.tcpa=null;return}var s={x:e.x+r*e.vx,y:e.y+r*e.vy},d={x:a.x+r*a.vx,y:a.y+r*a.vy},l=We(s,d);a.cpa=Math.round(l),a.tcpa=Math.round(r)}function j(e,a){return e.x*a.x+e.y*a.y}function ze(e){return Math.sqrt(j(e,e))}function We(e,a){return ze({x:e.x-a.x,y:e.y-a.y})}function He(e,a){try{e.guardAlarm=e.range!=null&&e.range<a[a.current].guard.range*E&&(a[a.current].guard.speed==0||e.sog!=null&&e.sog>a[a.current].guard.speed/F),e.collisionAlarm=e.cpa!=null&&e.cpa<a[a.current].danger.cpa*E&&e.tcpa!=null&&e.tcpa>0&&e.tcpa<a[a.current].danger.tcpa&&(a[a.current].danger.speed==0||e.sog!=null&&e.sog>a[a.current].danger.speed/F),e.collisionWarning=e.cpa!=null&&e.cpa<a[a.current].warning.cpa*E&&e.tcpa!=null&&e.tcpa>0&&e.tcpa<a[a.current].warning.tcpa&&(a[a.current].warning.speed==0||e.sog!=null&&e.sog>a[a.current].warning.speed/F),e.sartAlarm=e.mmsi.startsWith("970"),e.mobAlarm=e.mmsi.startsWith("972"),e.epirbAlarm=e.mmsi.startsWith("974"),e.guardAlarm||e.collisionAlarm||e.sartAlarm||e.mobAlarm||e.epirbAlarm?(e.alarmState="danger",e.order=1e4):e.collisionWarning?(e.alarmState="warning",e.order=2e4):e.tcpa!=null&&e.tcpa>0?(e.alarmState=null,e.order=3e4):(e.alarmState=null,e.order=4e4);var t=[];if(e.guardAlarm&&t.push("guard"),(e.collisionAlarm||e.collisionWarning)&&t.push("cpa"),e.sartAlarm&&t.push("sart"),e.mobAlarm&&t.push("mob"),e.epirbAlarm&&t.push("epirb"),t.length>0?e.alarmType=t.join(","):e.alarmType=null,e.tcpa!=null&&e.tcpa>0){e.order-=1e3;var n=1e3;e.order-=Math.max(0,Math.round(n-n*e.tcpa/3600))}if(e.cpa!=null&&e.cpa>0){var n=2e3;e.order-=Math.max(0,Math.round(n-n*e.cpa/5/E))}e.range!=null&&e.range>0&&(e.order+=Math.round(100*e.range/E)),e.range==null&&(e.order+=99999)}catch(o){console.error("error in evaluateAlarms",o.message,o)}}function Ze(e,a,t,n){var o=6371e3,r=g(t-e),s=g(n-a),d=Math.sin(r/2)*Math.sin(r/2)+Math.cos(g(e))*Math.cos(g(t))*Math.sin(s/2)*Math.sin(s/2),l=2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),h=o*l;return h}function _e(e,a,t,n){var o=g(n-a),r=Math.log(Math.tan(g(t)/2+Math.PI/4)/Math.tan(g(e)/2+Math.PI/4));return Math.abs(o)>Math.PI&&(o>0?o=(Math.PI*2-o)*-1:o=Math.PI*2+o),(M(Math.atan2(o,r))+360)%360}function je(e){return e.startsWith("111")||e.startsWith("970")?e.substring(3,6):e.startsWith("00")||e.startsWith("98")||e.startsWith("99")?e.substring(2,5):e.startsWith("0")||e.startsWith("8")?e.substring(1,4):e.substring(0,3)}function Je(e){var a=Math.abs(e),t=("0"+Math.floor(a)).slice(-2),n=("0"+((a-t)*60).toFixed(4)).slice(-7);return(e>0?"N":"S")+" "+t+"° "+n}function qe(e){var a=Math.abs(e),t=("00"+Math.floor(a)).slice(-3),n=("0"+((a-t)*60).toFixed(4)).slice(-7);return(e>0?"E":"W")+" "+t+"° "+n}function Ye(e){return e!=null?(e/E).toFixed(2)+" NM":"---"}function Qe(e){return e==null||e<0?"---":Math.abs(e)>=3600?new Date(1e3*Math.abs(e)).toISOString().substring(11,19):new Date(1e3*Math.abs(e)).toISOString().substring(14,19)}var Xe=`
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cursor-fill" viewBox="0 0 16 16">
  <path d="M14.082 2.182a.5.5 0 0 1 .103.557L8.528 15.467a.5.5 0 0 1-.917-.007L5.57 10.694.803 8.652a.5.5 0 0 1-.006-.916l12.728-5.657a.5.5 0 0 1 .556.103z"/>
</svg>`,ea=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-volume-up-fill" viewBox="0 0 16 16">
  <path d="M11.536 14.01A8.47 8.47 0 0 0 14.026 8a8.47 8.47 0 0 0-2.49-6.01l-.708.707A7.48 7.48 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303z"/>
  <path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.48 5.48 0 0 1 11.025 8a5.48 5.48 0 0 1-1.61 3.89z"/>
  <path d="M8.707 11.182A4.5 4.5 0 0 0 10.025 8a4.5 4.5 0 0 0-1.318-3.182L8 5.525A3.5 3.5 0 0 1 9.025 8 3.5 3.5 0 0 1 8 10.475zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06"/>
</svg>`,aa=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-volume-mute-fill" viewBox="0 0 16 16">
  <path d="M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06m7.137 2.096a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0"/>
</svg>`,na=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-layers-fill" viewBox="0 0 16 16">
  <path d="M7.765 1.559a.5.5 0 0 1 .47 0l7.5 4a.5.5 0 0 1 0 .882l-7.5 4a.5.5 0 0 1-.47 0l-7.5-4a.5.5 0 0 1 0-.882z"/>
  <path d="m2.125 8.567-1.86.992a.5.5 0 0 0 0 .882l7.5 4a.5.5 0 0 0 .47 0l7.5-4a.5.5 0 0 0 0-.882l-1.86-.992-5.17 2.756a1.5 1.5 0 0 1-1.41 0z"/>
</svg>`,ta=`
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5"/>
  <path d="M1.713 11.865v-.474H2c.217 0 .363-.137.363-.317 0-.185-.158-.31-.361-.31-.223 0-.367.152-.373.31h-.59c.016-.467.373-.787.986-.787.588-.002.954.291.957.703a.595.595 0 0 1-.492.594v.033a.615.615 0 0 1 .569.631c.003.533-.502.8-1.051.8-.656 0-1-.37-1.008-.794h.582c.008.178.186.306.422.309.254 0 .424-.145.422-.35-.002-.195-.155-.348-.414-.348h-.3zm-.004-4.699h-.604v-.035c0-.408.295-.844.958-.844.583 0 .96.326.96.756 0 .389-.257.617-.476.848l-.537.572v.03h1.054V9H1.143v-.395l.957-.99c.138-.142.293-.304.293-.508 0-.18-.147-.32-.342-.32a.33.33 0 0 0-.342.338zM2.564 5h-.635V2.924h-.031l-.598.42v-.567l.629-.443h.635z"/>
</svg>`,oa=`
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear-fill" viewBox="0 0 16 16">
  <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
</svg>`;function ra(e,a,t){var n=50,o=2;a&&(n=70,o=4);var r=1.8,s=10,d=n-2*s,l=s/2,h=d/r,p=n*.8;const $=`
    <svg width="${n}px" height="${n}px" pointerEvents="none">
        <polygon
            points="${n/2-h/2},  ${n/2+d/2-l} 
                    ${n/2},                 ${n/2-d/2-l} 
                    ${n/2+h/2},  ${n/2+d/2-l}"
            fill="${t}"
            fill-opacity=0.3
            stroke-width=${o}
            stroke="${t}"
            stroke-opacity=1
            pointer-events="all"
            transform="rotate(${M(e.hdg||e.cog)||0} ${n/2} ${n/2})"
        />
        ${e.isLost?`
        <path d="M${n*.5},${n*.5-p/2} v${p} M${n*.5-p/2},${n*.5} h${p}"
            stroke="red"
            stroke-width=2
            stroke-opacity=1
            transform="rotate(45 ${n/2} ${n/2})"
        />`:""}
    </svg>`;return L.divIcon({className:"foobar",html:$,iconAnchor:[n/2,n/2]})}function ia(e,a,t){var n=50,o=2;a&&(n=70,o=4);var r=2.2,s=.4,d=10,l=n-2*d,h=l/r,p=n*.8;const $=`
    <svg width="${n}px" height="${n}px" pointerEvents="none">
        <polygon
            points="
                ${n/2-h/2},   ${n/2+l/2} 
                ${n/2-h/2},   ${n/2-l/2+l*s} 
                ${n/2},                  ${n/2-l/2} 
                ${n/2+h/2},   ${n/2-l/2+l*s} 
                ${n/2+h/2},   ${n/2+l/2}"
            fill="${t}"
            fill-opacity=0.3
            stroke-width=${o}
            stroke="${t}"
            stroke-opacity=1
            pointer-events="all"
            transform="rotate(${M(e.hdg||e.cog)||0} ${n/2} ${n/2})"
        />
        ${e.isLost?`
        <path d="M${n*.5},${n*.5-p/2} v${p} M${n*.5-p/2},${n*.5} h${p}"
            stroke="red"
            stroke-width=2
            stroke-opacity=1
            transform="rotate(45 ${n/2} ${n/2})"
        />`:""}
    </svg>`;return L.divIcon({className:"foobar",html:$,iconAnchor:[n/2,n/2]})}function sa(){var e=80,a=10,t=e-2*a;const n=`
    <svg width="${e}px" height="${e}px" pointerEvents="none">
        <rect
            style="stroke:#3c48be;stroke-width:5;stroke-dasharray:${t*3/4} ${t/4} ${t*3/4} ${t/4};stroke-dashoffset:${t*3/8};stroke-opacity:1.0;fill-opacity:0"
            width="${t}"
            height="${t}"
            x="${a}"
            y="${a}" />
    </svg>`;return L.divIcon({className:"foobar",html:n,iconAnchor:[e/2,e/2]})}function da(e,a,t){var n=40,o=2;a&&(n=50,o=4);var r=12,s=n-2*r,d=s*.6,l=n*.8;const h=`
    <svg width="${n}px" height="${n}px" pointerEvents="none">
        <rect x="${r}" y="${r}" width="${s}" height="${s}" 
            transform="rotate(45 ${n/2} ${n/2})"
            fill="${t}"
            fill-opacity=0.3
            stroke-width=${o}
            ${e.isVirtual?'stroke-dasharray="2 2"':""}
            stroke="${t}"
            stroke-opacity=1
        />
        <path d="M${n*.5},${n*.5-d/2} v${d} M${n*.5-d/2},${n*.5} h${d}"
            stroke="${t}"
            stroke-width=2
            stroke-opacity=1
        />
        ${e.isLost?`
        <path d="M${n*.5},${n*.5-l/2} v${l} M${n*.5-l/2},${n*.5} h${l}"
            stroke="red"
            stroke-width=2
            stroke-opacity=1
            transform="rotate(45 ${n/2} ${n/2})"
        />`:""}
    </svg>`;return L.divIcon({className:"foobar",html:h,iconAnchor:[n/2,n/2]})}function la(e,a,t){var n=40,o=2;a&&(n=50,o=4);var r=12,s=n-2*r,d=s*.6,l=n*.8;const h=`
    <svg width="${n}px" height="${n}px" pointerEvents="none">
        <rect x="${r}" y="${r}" width="${s}" height="${s}" 
            fill="${t}"
            fill-opacity=0.3
            stroke-width=${o}
            stroke="${t}"
            stroke-opacity=1
        />
        <path d="M${n*.5},${n*.5-d/2} v${d} M${n*.5-d/2},${n*.5} h${d}"
            stroke="${t}"
            stroke-width=2
            stroke-opacity=1
        />
        ${e.isLost?`
        <path d="M${n*.5},${n*.5-l/2} v${l} M${n*.5-l/2},${n*.5} h${l}"
            stroke="red"
            stroke-width=2
            stroke-opacity=1
            transform="rotate(45 ${n/2} ${n/2})"
        />`:""}
    </svg>`;return L.divIcon({className:"foobar",html:h,iconAnchor:[n/2,n/2]})}function ca(){var e=40,a=2,t=15;const n=`
    <svg width="${e}px" height="${e}px" pointerEvents="none">
        <g
            fill-opacity=0
            stroke-width=${a}
            stroke="red"
            stroke-opacity=1
        >
            <circle cx="${e/2}" cy="${e/2}" r="${t}" />
            <path d="M${e*.5},${e*.5-t} v${t*2} M${e*.5-t},${e*.5} h${t*2}" 
                transform="rotate(45 ${e/2} ${e/2})"
            />
        </g>
    </svg>`;return L.divIcon({className:"foobar",html:n,iconAnchor:[e/2,e/2]})}function ma(){var e=40,a=2;const t=`
    <svg width="${e}px" height="${e}px" pointerEvents="none">
        <g
            fill-opacity=0
            stroke-width=${a}
            stroke="gray"
            stroke-opacity=1
        >
            <circle cx="${e/2}" cy="${e/2}" r="17" />
            <circle cx="${e/2}" cy="${e/2}" r="7" />
        </g>
    </svg>`;return L.divIcon({className:"foobar",html:t,iconAnchor:[e/2,e/2]})}const ua=14,ye=1852,fa=10,ha=!0,X=1800,pa=60*1e3,N="signalk-ais-target-prioritizer";var he=new NoSleep,c,v,m,ee=0,ae=0,J=!1,ne=!1,u=new Map,R,y=new Map,T=new Map,A=L.layerGroup(),f,S,I,C,te,oe,k,K,w="priority",re=L.layerGroup();const va=new bootstrap.Modal("#modalAlert"),ga=new bootstrap.Modal("#modalAlarm"),ya=new bootstrap.Modal("#modalClosebyBoats"),be=new bootstrap.Modal("#modalSelectedVesselProperties"),Me=new bootstrap.Offcanvas("#offcanvasSettings"),ba=new bootstrap.Offcanvas("#offcanvasEditProfiles"),Se=new bootstrap.Offcanvas("#offcanvasTargetList"),Le=await b("./assets/js/defaultCollisionProfiles.json",{throwErrors:!0});c=await b(`/plugins/${N}/getCollisionProfiles`,{throwErrors:!0});console.log("collisionProfiles",c);c.current||(console.log("using default collisionProfiles"),c=structuredClone(Le),D());document.getElementById("selectActiveProfile").value=c.current;document.getElementById("checkNoSleep").checked=localStorage.getItem("checkNoSleep")=="true";$e();var pe=await b("/signalk/v1/api/resources/charts",{throwErrors:!1,ignore404:!0,ignoreEmptyResponse:!0}),Ma=await b("/signalk/v1/api/vessels/self",{throwErrors:!0});v=Ma.mmsi;R=await b(`/plugins/${N}/getTargets`);const i=L.map("map",{zoom:ua,minZoom:9,maxZoom:18});L.easyButton(Xe,function(e,a){m.isValid&&(a.panTo([m.latitude,m.longitude]),ee=0,ae=0)}).addTo(i);var Ee=protomapsL.paintRules({...basemaps.namedFlavor("light"),water:"rgba(0,0,0,0)"}),Ie=protomapsL.labelRules(basemaps.namedFlavor("light")),Sa=L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"© OpenStreetMap"}),La=L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"Map data: © OpenStreetMap contributors, SRTM | Map style: © OpenTopoMap (CC-BY-SA)"}),Ea=protomapsL.leafletLayer({url:"assets/pmtiles/ne_10m_land.pmtiles",maxDataZoom:5,paintRules:Ee,labelRules:Ie}),O={Empty:L.tileLayer(""),OpenStreetMap:Sa,OpenTopoMap:La,"NaturalEarth (offline)":Ea};for(let e in pe){var B=pe[e],z;B.format=="mvt"?z=protomapsL.leafletLayer({url:B.tilemapUrl,maxDataZoom:B.maxzoom,paintRules:Ee,labelRules:Ie}):z=L.tileLayer(B.tilemapUrl,{maxZoom:B.maxzoom,attribution:""}),O[B.name]=z}var Ia=L.tileLayer("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:19,attribution:""}),q={OpenSeaMap:Ia};L.control.layers(O,q,{position:"topleft"}).addTo(i);var Ca=document.getElementsByClassName("leaflet-control-layers-toggle")[0];Ca.innerHTML=na;L.easyButton(ta,function(e,a){Se.show()}).addTo(i);L.easyButton(oa,function(e,a){Me.show()}).addTo(i);var Y=localStorage.getItem("baselayer"),W=localStorage.getItem("overlay");O[Y]||(Y="OpenStreetMap");O[Y].addTo(i);W&&q[W]&&q[W].addTo(i);S=L.marker([],{icon:sa()});I=L.circleMarker([],{radius:6,color:"blue",opacity:1,fillOpacity:1,interactive:!1,className:"blueStuff"});C=L.circleMarker([],{radius:6,color:"blue",opacity:1,fillOpacity:1,interactive:!1,className:"blueStuff"});re.addLayer(S);re.addLayer(I);re.addLayer(C);var $a=function(e){e.labelObject.style.opacity=0},Aa=function(e){e.labelObject.style.opacity=1},U=new labelgun.default($a,Aa);const Ce=document.getElementById("alertPlaceholder");i.on("baselayerchange",wa);i.on("overlayadd",Ta);i.on("overlayremove",xa);document.getElementById("tableOfTargetsBody").addEventListener("click",Na);document.getElementById("listOfClosebyBoats").addEventListener("click",_a);document.getElementById("selectActiveProfile").addEventListener("input",e=>{c.current=e.target.value,D()});document.getElementById("selectTableSort").addEventListener("input",e=>{w=e.target.value});document.getElementById("buttonEditProfiles").addEventListener("click",()=>{Me.hide(),selectProfileToEdit.value=selectActiveProfile.value,V(selectProfileToEdit.value),ba.show()});document.getElementById("checkNoSleep").addEventListener("change",e=>{$e()});document.getElementById("checkDarkMode").addEventListener("change",ie);document.getElementById("checkFullScreen").addEventListener("change",e=>{checkFullScreen.checked?document.fullscreenElement?document.webkitFullscreenElement||document.documentElement.webkitRequestFullscreen():document.documentElement.requestFullscreen():document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()});document.addEventListener("fullscreenchange",Ba);document.getElementById("selectProfileToEdit").addEventListener("input",e=>{V(e.target.value)});document.getElementById("buttonRestoreDefaults").addEventListener("click",()=>{c=structuredClone(Le),V(selectProfileToEdit.value),D()});document.getElementById("buttonMuteAllAlarms").addEventListener("click",Te);document.getElementById("buttonMuteAllAlarms2").addEventListener("click",Te);document.getElementById("buttonMuteToggle").addEventListener("click",Oa);document.getElementsByClassName("");offcanvasEditProfiles.addEventListener("hide.bs.offcanvas",()=>{D()});modalClosebyBoats.addEventListener("hidden.bs.modal",()=>{var e=y.get(f);P(e.getLatLng(),"modalSelectedVesselProperties"),le(u.get(f))});configWarningCpaRange.addEventListener("input",se);configWarningTcpaRange.addEventListener("input",Ae);configWarningSogRange.addEventListener("input",de);configAlarmCpaRange.addEventListener("input",se);configAlarmTcpaRange.addEventListener("input",Ae);configAlarmSogRange.addEventListener("input",de);configGuardRangeRange.addEventListener("input",se);configGuardSogRange.addEventListener("input",de);i.on("movestart",function(e){ne=!0});i.on("moveend",function(e){if(ne=!1,!J&&m.isValid){var a=i.getCenter();ee=a.lat-m.latitude,ae=a.lng-m.longitude}});i.on("zoomend",function(e){Be(),U.update()});i.on("click",ja);function Ba(){document.fullscreenElement?checkFullScreen.checked=!0:checkFullScreen.checked=!1}function ie(){if(checkDarkMode.checked){document.documentElement.setAttribute("data-bs-theme","dark");for(var e=document.querySelectorAll(".leaflet-layer"),a=0;a<e.length;a++)e[a].style.filter="invert(1) hue-rotate(180deg) brightness(0.8) contrast(1.2)"}else{document.documentElement.setAttribute("data-bs-theme","light");for(var e=document.querySelectorAll(".leaflet-layer"),a=0;a<e.length;a++)e[a].style.filter="none"}}function $e(){checkNoSleep.checked?he.enable():he.disable(),localStorage.setItem("checkNoSleep",checkNoSleep.checked)}function wa(e){localStorage.setItem("baselayer",e.name),ie()}function Ta(e){localStorage.setItem("overlay",e.name),ie()}function xa(e){localStorage.removeItem("overlay")}V("anchor");we();setInterval(we,1e3);function V(e){configWarningCpaRange.value=H(c[e].warning.cpa),configWarningTcpaRange.value=ve(c[e].warning.tcpa/60),configWarningSogRange.value=Z(c[e].warning.speed),configAlarmCpaRange.value=H(c[e].danger.cpa),configAlarmTcpaRange.value=ve(c[e].danger.tcpa/60),configAlarmSogRange.value=Z(c[e].danger.speed),configGuardRangeRange.value=H(c[e].guard.range),configGuardSogRange.value=Z(c[e].guard.speed);var a=new Event("input");configWarningCpaRange.dispatchEvent(a),configWarningTcpaRange.dispatchEvent(a),configWarningSogRange.dispatchEvent(a),configAlarmCpaRange.dispatchEvent(a),configAlarmTcpaRange.dispatchEvent(a),configAlarmSogRange.dispatchEvent(a),configGuardRangeRange.dispatchEvent(a),configGuardSogRange.dispatchEvent(a)}async function D(){console.log("*** save collisionProfiles to server",c);var e=await fetch(`/plugins/${N}/setCollisionProfiles`,{credentials:"include",method:"PUT",body:JSON.stringify(c),headers:{"Content-Type":"application/json"}});if(e.status==401&&(location.href="/admin/#/login"),!e.ok)throw new Error(`Error saving collisionProfiles. Response status: ${e.status} from ${e.url}`);console.log("successfully saved config",c)}function Q(e){document.getElementById("errorMessage").innerHTML=e,va.show()}function Na(e){Se.hide();var a=e.target.parentNode.dataset.mmsi,t=y.get(a);G(t),i.fitBounds([t.getLatLng(),y.get(v).getLatLng()]),P(t.getLatLng(),"modalSelectedVesselProperties"),le(u.get(t.mmsi))}function H(e){return e<=1?Math.floor(e*10):Math.floor(e+9)}function Fa(e){return e<=10?e/10:e-9}function se(e){var a=e.target.value,t=e.target.dataset,n=document.getElementById(t.target),o=Fa(a),r=document.getElementById(t.target+"Units");o==0?r.hidden=!0:r.hidden=!1,n.textContent=o||"OFF",c[selectProfileToEdit.value][t.alarmType][t.alarmCriteria]=o}function ve(e){return e<=5?Math.floor(e):e<=20?Math.floor((e-10)/5+6):Math.floor((e-30)/10+9)}function Ra(e){return e<=5?e:e<=8?(e-6)*5+10:(e-9)*10+30}function Ae(e){var a=e.target.value,t=e.target.dataset,n=document.getElementById(t.target),o=Ra(a);n.textContent=o,c[selectProfileToEdit.value][t.alarmType][t.alarmCriteria]=o*60}function Z(e){return e<=.5?Math.floor(e*10):e<=3?Math.floor(e+5):Math.floor(e/5+8)}function ka(e){return e<=5?e/10:e<=8?e-5:(e-8)*5}function de(e){var a=e.target.value,t=e.target.dataset,n=document.getElementById(t.target),o=ka(a);n.textContent=o,c[selectProfileToEdit.value][t.alarmType][t.alarmCriteria]=o}function Be(){if(m.isValid){A.removeFrom(i),A.clearLayers();var e=60*Math.abs(i.getBounds().getNorth()-i.getBounds().getSouth()),a=e/6;a<.125?a=.125:a<.25?a=.25:a<.5?a=.5:a<1?a=1:a=2*Math.round(a/2);for(var t=1;t<=6;t++)A.addLayer(L.circle([m.latitude,m.longitude],{radius:t*a*ye,color:"gray",weight:1,opacity:.7,fill:!1,interactive:!1,zIndexOffset:-999})),A.addLayer(L.tooltip([m.latitude+t*a/60,m.longitude],{content:t*a+" NM",permanent:!0,direction:"center",opacity:.7,offset:[0,15],className:"map-labels",interactive:!1,zIndexOffset:-999})),A.addLayer(L.tooltip([m.latitude-t*a/60,m.longitude],{content:t*a+" NM",permanent:!0,direction:"center",opacity:.7,offset:[0,-15],className:"map-labels",interactive:!1,zIndexOffset:-999}));A.addTo(i)}}async function we(){try{var e=new Date,a=await b("/signalk/v1/api/vessels",{throwErrors:!0}),t=await b("/signalk/v1/api/atons",{ignore404:!0});a=Object.assign(a,t),te=0,oe=0,k=0,Va(a),m=u.get(v);try{Ve(u,m,c,X)}catch(r){console.error(r),Q(`No GPS position available. Verify that you are connected to the 
                SignalK server and that the SignalK server has a position for your vessel.<br><br>
                ${r}`)}Pa(),Ka(),ha&&Wa(),k>0&&(K==null||Date.now()>K+pa)&&(K=Date.now(),Ga()),m.lastSeen>20&&(console.error(`No GPS position received for more than ${m.lastSeen} seconds`),Q(`No GPS position received for more than ${m.lastSeen} seconds. Verify that you are connected to the 
                SignalK server and that the SignalK server has a position for your vessel.`));let o=0;i.eachLayer(function(){o++});var n=new Date().getTime()-e.getTime();i.attributionControl.setPrefix(`${n} msecs / ${o} layers`)}catch(o){console.error("Error in refresh:",o)}}function Pa(){if(R){var e;u.forEach((a,t)=>{e=R[t],e&&e.alarmIsMuted&&(console.log(`setting target ${t} ${a.name} to muted because it is muted in the plugin`),a.alarmIsMuted=!0)}),R=null}}function Ga(){var e=[];u.forEach((a,t)=>{a.isValid&&a.alarmState&&!a.alarmIsMuted&&e.push(a)}),e.length>0&&(document.getElementById("alarmDiv").innerHTML=" ",e.forEach(a=>{var t=`${a.name} - ${a.alarmType.toUpperCase()} - `;a.alarmType.includes("cpa")?t+=`${a.cpaFormatted} ${a.tcpaFormatted}`:t+=`${a.rangeFormatted}`,document.getElementById("alarmDiv").innerHTML+=`<div class="alert alert-danger" role="alert">${t}</div>`}),ga.show(),new Audio("./assets/audio/horn.mp3").play())}async function Te(){console.log("muting all alarms"),u.forEach((e,a)=>{e.alarmState=="danger"&&!e.alarmIsMuted&&(console.log("muting alarm for target",a,e.name,e.alarmType,e.alarmState),e.alarmIsMuted=!0)}),await b(`/plugins/${N}/muteAllAlarms`,{throwErrors:!0,ignoreEmptyResponse:!0})}async function Oa(){var e=u.get(f);e.alarmIsMuted=!e.alarmIsMuted,xe(e),Ua(`Target ${e.alarmIsMuted?"":"un"}muted`,"success"),console.log("setting alarmIsMuted",e.mmsi,e.name,e.alarmIsMuted),await b(`/plugins/${N}/setAlarmIsMuted/${e.mmsi}/${e.alarmIsMuted}`,{throwErrors:!0,ignoreEmptyResponse:!0})}function xe(e){e.alarmIsMuted?document.getElementById("buttonMuteToggle").innerHTML=aa:document.getElementById("buttonMuteToggle").innerHTML=ea}function Ua(e,a){Ce.innerHTML=[`<div class="alert alert-${a} alert-dismissible" role="alert">`,`   <div>${e}</div>`,'   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',"</div>"].join("")}function Va(e){for(var a in e){var t=e[a],n=u.get(t.mmsi);n||(n={}),n.lastSeenDate=new Date(t.navigation?.position?.timestamp);var o=Math.round((new Date-n.lastSeenDate)/1e3);o>=X||(n.mmsi=t.mmsi,n.name=t.name||"<"+t.mmsi+">",n.sog=t.navigation?.speedOverGround?.value,n.cog=t.navigation?.courseOverGroundTrue?.value,n.hdg=t.navigation?.headingTrue?.value,n.rot=t.navigation?.rateOfTurn?.value,n.callsign=t.communication?.callsignVhf||"---",n.type=(t.design?.aisShipType?.value.name||t.atonType?.value.name)??"---",n.aisClass=t.sensors?.ais?.class?.value||"A",n.isVirtual=t.virtual?.value,n.isOffPosition=t.offPosition?.value,n.status=t.navigation?.state?.value??"---",n.length=t.design?.length?.value.overall,n.beam=t.design?.beam?.value,n.draft=t.design?.draft?.current??"---",n.destination=t.navigation?.destination?.commonName?.value??"---",n.eta=t.navigation?.destination?.eta?.value??"---",n.imo=t.registrations?.imo,n.latitude=t.navigation?.position?.value.latitude,n.longitude=t.navigation?.position?.value.longitude,u.set(n.mmsi,n))}}function Ne(e){xe(e),document.getElementById("target.name").textContent=e.name,document.getElementById("target.lastSeen").textContent=e.lastSeen,document.getElementById("target.cpaFormatted").textContent=e.cpaFormatted,document.getElementById("target.tcpaFormatted").textContent=e.tcpaFormatted,document.getElementById("target.rangeFormatted").textContent=e.rangeFormatted,document.getElementById("target.bearingFormatted").textContent=e.bearingFormatted,document.getElementById("target.sogFormatted").textContent=e.sogFormatted,document.getElementById("target.cogFormatted").textContent=e.cogFormatted,document.getElementById("target.hdgFormatted").textContent=e.hdgFormatted,document.getElementById("target.rotFormatted").textContent=e.rotFormatted,document.getElementById("target.callsign").textContent=e.callsign,document.getElementById("target.mmsi").textContent=e.mmsi,document.getElementById("target.mmsiCountryCode").textContent=e.mmsiCountryCode,document.getElementById("target.mmsiCountryCode").setAttribute("data-bs-title",e.mmsiCountryName),document.getElementById("target.type").textContent=e.type,document.getElementById("target.aisClassFormatted").textContent=e.aisClassFormatted,document.getElementById("target.status").textContent=e.status,document.getElementById("target.sizeFormatted").textContent=e.sizeFormatted,document.getElementById("target.draft").textContent=e.draft,document.getElementById("target.destination").textContent=e.destination,document.getElementById("target.eta").textContent=e.eta,document.getElementById("target.imoFormatted").textContent=e.imoFormatted,document.getElementById("target.latitudeFormatted").textContent=e.latitudeFormatted,document.getElementById("target.longitudeFormatted").textContent=e.longitudeFormatted,Da();var a=document.querySelectorAll(".ais-class-a");e.aisClass=="A"?[...a].map(n=>n.classList.remove("d-none")):[...a].map(n=>n.classList.add("d-none"));var t=document.getElementById("selectedVesselAlert");e.alarmState=="danger"?(t.classList.remove("alert-warning"),t.classList.add("alert-danger"),t.textContent=(e.alarmType+" alarm").toUpperCase(),t.classList.remove("d-none")):e.alarmState=="warning"?(t.classList.remove("alert-danger"),t.classList.add("alert-warning"),t.textContent=(e.alarmType+" warning").toUpperCase(),t.classList.remove("d-none")):t.classList.add("d-none")}function Da(){[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map(a=>new bootstrap.Tooltip(a))}function Ka(){if(m.isValid){if(!ne)try{J=!0,i.panTo([m.latitude+ee,m.longitude+ae],{animate:!1})}finally{J=!1}Be()}u.forEach((e,a)=>{x(e),e.mmsi==f&&Ne(e)}),U.update(),za(),totalTargetCountUI.textContent=te||0,filteredTargetCountUI.textContent=oe||0,alarmTargetCountUI.textContent=k||0}function za(){var e=Array.from(u.values());e.sort(function(o,r){try{return w=="tcpa"?o.tcpa-r.tcpa:w=="cpa"?o.cpa-r.cpa:w=="range"?o.range-r.range:w=="name"?o.name>r.name?1:-1:o.order-r.order}catch(s){return console.error(s),0}});var a="",t=0;for(var n of e)n.mmsi!=v&&n.isValid&&(a+=`
                <tr class="${n.alarmState=="danger"?"table-danger":n.alarmState=="warning"?"table-warning":""}" data-mmsi="${n.mmsi}">
                <th scope="row">${n.name}</th>
                <td>${n.bearingFormatted}</td>
                <td>${n.rangeFormatted}</td>
                <td>${n.sogFormatted}</td>
                <td>${n.cpa?n.cpaFormatted:""}</td>
                <td>${n.cpa?n.tcpaFormatted:""}</td>
                </tr>`,t++);document.getElementById("tableOfTargetsBody").innerHTML=a,document.getElementById("numberOfAisTargets").textContent=t}function x(e){if(e.isValid){var a=y.get(e.mmsi),t=T.get(e.mmsi);if(!a){var n=ge(e,!1,"gray");a=L.marker([0,0],{icon:n,riseOnHover:!0}).addTo(i),y.set(e.mmsi,a),a.bindTooltip("",{permanent:!0,direction:"right",opacity:.7,offset:[25,10],className:"map-labels",interactive:!1,zIndexOffset:-999}),e.mmsi!=v&&a.on("click",Ha),t=L.polyline([[]],{color:"gray",opacity:.7,interactive:!1,dashArray:"20 10",zIndexOffset:-999}).addTo(i),T.set(e.mmsi,t)}a.setLatLng([e.latitude,e.longitude]);var o,r;if(e.mmsi==f?(o="blue",r=!0):e.alarmState=="danger"?(o="red",r=!0):e.alarmState=="warning"?(o="orange",r=!0):(o="gray",r=!1),a.setIcon(ge(e,r,o)),e.mmsi==f&&S&&S.setLatLng([e.latitude,e.longitude]),a.mmsi=e.mmsi,e.mmsi!=v){te++,e.alarmState&&(oe++,e.alarmState=="danger"&&k++);var s=e.name+"<br/>";e.sog>.1&&(s+=e.sogFormatted+" "),e.cpa&&(s+=e.cpaFormatted+" "),e.tcpa>0&&e.tcpa<3600&&(s+=e.tcpaFormatted),s+="&nbsp",a.setTooltipContent(s),Ja(a,e.mmsi,e.order)}if(e.mmsi==v&&f){var d=_([e.latitude,e.longitude],e.cog||0,(e.sog||0)*(u.get(f).tcpa||0));t.setLatLngs([[e.latitude,e.longitude],d]),t.setStyle({color:"blue",opacity:1,interactive:!1,dashArray:"",className:"blueStuff"}),I.setLatLng(d),i.hasLayer(I)||I.addTo(i)}else if(f==e.mmsi){var d=_([e.latitude,e.longitude],e.cog||0,(e.sog||0)*(e.tcpa||0));t.setLatLngs([[e.latitude,e.longitude],d]),t.setStyle({color:"blue",opacity:1,interactive:!1,dashArray:"",className:"blueStuff"}),C.setLatLng(d),i.hasLayer(C)||C.addTo(i)}else t.setLatLngs([[e.latitude,e.longitude],_([e.latitude,e.longitude],e.cog||0,(e.sog||0)*60*fa)]),t.setStyle({color:o,opacity:.7,interactive:!1,dashArray:"20 10"})}}function Wa(){u.forEach((e,a)=>{a!=v&&e.lastSeen>X&&(console.log("aging out old target",a,e.name,e.mmsi,e.lastSeen/60),a==f&&(S.removeFrom(i),I.removeFrom(i),C.removeFrom(i),be.hide(),f=null),y.has(a)&&(y.get(a).removeFrom(i),y.delete(a)),T.has(a)&&(T.get(a).removeFrom(i),T.delete(a)),U.removeLabel(a,null),u.delete(a))})}function Ha(e){var a=e.target,t=Za(e.latlng);if(t.length>1){t.sort(function(s,d){return s.distanceInPixels-d.distanceInPixels});var n=document.getElementById("listOfClosebyBoats");n.innerHTML="";var o,r;t.forEach((s,d)=>{o=u.get(s.mmsi),r=document.createElement("a"),r.href="#",r.setAttribute("data-bs-toggle","list"),r.setAttribute("data-mmsi",o.mmsi),r.classList="list-group-item list-group-item-action",d==0&&r.classList.add("active"),o.alarmState=="danger"?r.classList.add("list-group-item-danger"):o.alarmState=="warning"&&r.classList.add("list-group-item-warning"),r.appendChild(document.createTextNode(o.name)),n.appendChild(r)}),G(t[0]),P(a.getLatLng(),"modalClosebyBoats"),ya.show();return}G(a),P(a.getLatLng(),"modalSelectedVesselProperties"),le(u.get(a.mmsi))}function le(e){Ne(e),Ce.innerHTML="",be.show()}function P(e,a){var t=i.latLngToContainerPoint(e),n=document.getElementById("map").clientWidth,o=document.getElementById(a).children[0];n>600?t.x>n/2?(o.style.marginLeft="100px",o.style.marginRight="auto"):(o.style.marginLeft="auto",o.style.marginRight="100px"):o.removeAttribute("style")}function Za(e){var a=i.getSize().y,t=Math.abs(i.getBounds().getNorth()-i.getBounds().getSouth())*60*ye,n=t/a,o=[];return y.forEach((r,s)=>{if(s!=v){var d=e.distanceTo(r.getLatLng()),l=d/n;l<30&&(r.distanceInPixels=l,o.push(r))}}),o}function _a(e){var a=y.get(e.target.dataset.mmsi);G(a)}function G(e){if(!(e.mmsi==v||e.mmsi==f)){S.setLatLng(e.getLatLng()),S.addTo(i),e.setZIndexOffset(1e3);var a;f&&(a=f),f=e.mmsi,x(u.get(f)),a&&x(u.get(a))}}function ja(e){if(S.removeFrom(i),I.removeFrom(i),C.removeFrom(i),f){var a=f;f=null,x(u.get(a)),x(u.get(v))}}function ge(e,a,t){if(e.mmsi==v)return ma();if(e.mmsi.startsWith("111")||e.mmsi.startsWith("970")||e.mmsi.startsWith("972")||e.mmsi.startsWith("974"))ca();else return e.aisClass=="ATON"||e.mmsi.startsWith("99")?da(e,a,t):e.aisClass=="A"?ia(e,a,t):e.aisClass=="BASE"?la(e,a,t):ra(e,a,t)}function Ja(e,a,t){var n=e.getTooltip()._source._tooltip._container;if(n){var o=n.getBoundingClientRect(),r=i.containerPointToLatLng([o.left,o.bottom]),s=i.containerPointToLatLng([o.right,o.top]),d={bottomLeft:[r.lng,r.lat],topRight:[s.lng,s.lat]};U.ingestLabel(d,a,-t,n,a,!1)}}function _(e,a,t){const[o,r]=e,s=Number(t)/6371e3,d=g(Number(o)),l=g(Number(r)),h=Math.sin(d),p=Math.cos(d),$=Math.sin(s),ce=Math.cos(s),Fe=Math.sin(a),Re=Math.cos(a),me=h*ce+p*$*Re,ke=Math.asin(me),Pe=Fe*$*p,Ge=ce-h*me,Oe=l+Math.atan2(Pe,Ge);return[M(ke),(M(Oe)+540)%360-180]}async function b(e,a){var t,n;try{if(n=await fetch(e,{credentials:"include"}),n.status==401&&(location.href="/admin/#/login"),n.ok){var o=await n.text();if(o)t=JSON.parse(o);else if(!a?.ignoreEmptyResponse)throw new Error(`Error: Got empty json response from ${e}`)}else if(!(n.status==404&&a?.ignore404)){if(console.error(`Response status: ${n.status} from ${e}`),a?.throwErrors)throw new Error(`Response status: ${n.status} from ${e}`)}}catch(r){if(console.error(`Error in getHttpResponse: url=${e}, options=${a}, status=${n?.status||"none"}`,r),a?.throwErrors)throw Q(`Encountered an error retrieving data from the SignalK server. Verify that you are connected to the SignalK server, that the SignalK 
                server is running, and that the AIS Target Prioritizer plugin is enabled.<br><br>
                <b>url</b>=${e},<br><b>options</b>=${JSON.stringify(a)},<br><b>status</b>=${n?.status||"none"},<br><b>error</b>=${r.message}`),new Error(`Error in getHttpResponse: url=${e}, options=${JSON.stringify(a)}, status=${n?.status||"none"}, error=${r.message}`)}return t}
